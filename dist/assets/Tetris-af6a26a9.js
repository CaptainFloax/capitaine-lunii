import{R as d,c as he,g as Ee}from"./index-b718f97b.js";const P={GAME_WIDTH:10,GAME_HEIGHT:20,BLOCK_WIDTH:4,BLOCK_HEIGHT:4,ROTATION_COUNT:4};var Oe=["I","J","L","O","S","T","Z"],Y=function(e){return e>=0&&e<P.ROTATION_COUNT},H=function(e){switch(e){case"I":return[[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]]];case"J":return[[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]]];case"L":return[[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]]];case"O":return[[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[1,1,0,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]];case"S":return[[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]];case"T":return[[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]];case"Z":return[[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]];default:{var r=e;throw new Error("Unhandled color case: ".concat(r))}}},z=function(e){switch(e){case"I":return"piece-i";case"J":return"piece-j";case"L":return"piece-l";case"O":return"piece-o";case"S":return"piece-s";case"T":return"piece-t";case"Z":return"piece-z";case"ghost":return"piece-preview";default:{var r=e;throw new Error("Unhandled piece case: ".concat(r))}}},l=globalThis&&globalThis.__assign||function(){return l=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},l.apply(this,arguments)},J=P.GAME_HEIGHT,Z=P.GAME_WIDTH,V=function(e){var r=e.x,n=e.y;return"".concat(r,",").concat(n)};function _e(){for(var e=new Array(J),r=0;r<e.length;r++)e[r]=$();return e}function $(){return new Array(Z).fill(null)}var G=function(e,r,n){n===void 0&&(n=!1);var o=r.piece,i=r.rotation,f=r.position,c=H(o)[i];if(!c)throw new Error("Unexpected: no rotation ".concat(i," found to piece ").concat(o));var h=c.reduce(function(p,C,L){return p.concat(C.map(function(b,D){return b?{x:D+f.x,y:L+f.y}:!1}))},[]),_=new Set(h.map(function(p){return p?V(p):""}).filter(Boolean)),O=n?"ghost":o;return e.map(function(p,C){return p.map(function(L,b){return _.has(V({x:b,y:C}))?O:L})})};function we(e,r){var n=G(e,r),o=Pe(n);return[n,o]}function Pe(e){for(var r=0,n=0;n<e.length;n++)Te(e[n])&&(e.splice(n,1),e.unshift($()),r+=1);return r}function Te(e){for(var r=0;r<e.length;r++)if(!e[r])return!1;return!0}function K(e,r){for(var n=r.piece,o=r.rotation,i=r.position,f=H(n)[o],c=0;c<P.BLOCK_WIDTH;c++)for(var h=0;h<P.BLOCK_HEIGHT;h++){var _=f[h][c],O=c+i.x,p=h+i.y;if(_)if(O>=0&&O<Z&&p<J){if(!e[p]||e[p][O])return!1}else return!1}return!0}function X(e){if(!e)throw new Error("assertion failed")}function A(e){return function(r,n){var o=e(n);if(K(r,o))return o}}var ye=A(function(e){var r=l(l({},e.position),{x:e.position.x-1});return l(l({},e),{position:r})}),Ie=A(function(e){var r=l(l({},e.position),{x:e.position.x+1});return l(l({},e),{position:r})}),Ce=A(function(e){var r=l(l({},e.position),{y:e.position.y+1});return l(l({},e),{position:r})}),Le=A(function(e){var r,n=(((r=e.rotation)!==null&&r!==void 0?r:0)+1)%P.ROTATION_COUNT;return X(Y(n)),l(l({},e),{rotation:n})}),be=A(function(e){var r,n=((r=e.rotation)!==null&&r!==void 0?r:0)-1;return n<0&&(n+=P.ROTATION_COUNT),X(Y(n)),l(l({},e),{rotation:n})});function Q(e,r){for(var n=l({},r.position);K(e,l(l({},r),{position:n}));)n.y+=1;return n.y-=1,l(l({},r),{position:n})}var I=globalThis&&globalThis.__assign||function(){return I=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},I.apply(this,arguments)};function me(e){return ee({minimumLength:e,queue:[],bucket:[]})}function ee(e){for(var r=[],n=e.bucket;r.length+e.queue.length<e.minimumLength;){var o=Ae(n),i=o[0],f=o[1];r.push(i),n=f}return I(I({},e),{queue:e.queue.concat(r)})}function g(e){if(!e.queue[0])throw new Error("Unexpected empty queue");var r=e.queue[0],n=e.queue.slice(1);return{piece:r,queue:ee(I(I({},e),{queue:n}))}}function Ae(e){var r=e.slice(0);r.length===0&&Oe.forEach(function(o){for(var i=0;i<4;i++)r.push(o)});var n=r.splice(Se(r.length),1)[0];if(!n)throw console.error("bucket:",JSON.stringify(r)),new Error("Unexpected: failed to pull from bucket");return[n,r]}function Se(e){return Math.floor(Math.random()*e)}var v=globalThis&&globalThis.__assign||function(){return v=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},v.apply(this,arguments)},ke=function(e){return Math.floor(e.lines/10)+1},Ke=function(e,r){var n,o;switch(r){case"RESTART":return U();case"PAUSE":return e.state==="PLAYING"?v(v({},e),{state:"PAUSED"}):e;case"RESUME":return e.state==="PAUSED"?v(v({},e),{state:"PLAYING"}):e;case"TOGGLE_PAUSE":return e.state==="PLAYING"?v(v({},e),{state:"PAUSED"}):e.state==="PAUSED"?v(v({},e),{state:"PLAYING"}):e;case"HARD_DROP":{if(e.state!=="PLAYING")return e;var i=Q(e.matrix,e.piece);return B(v(v({},e),{piece:i}))}case"TICK":case"MOVE_DOWN":{if(e.state!=="PLAYING")return e;var f=m(Ce,e);return e.piece===f.piece?B(f):f}case"MOVE_LEFT":return m(ye,e);case"MOVE_RIGHT":return m(Ie,e);case"FLIP_CLOCKWISE":return m(Le,e);case"FLIP_COUNTERCLOCKWISE":return m(be,e);case"HOLD":{if(e.state!=="PLAYING"||e.heldPiece&&!e.heldPiece.available||e.heldPiece&&!K(e.matrix,v(v({},e.piece),{piece:e.heldPiece.piece})))return e;var c=g(e.queue),h=(o=(n=e.heldPiece)===null||n===void 0?void 0:n.piece)!==null&&o!==void 0?o:c.piece;return v(v({},e),{heldPiece:{piece:e.piece.piece,available:!1},piece:q(h),queue:h===c.piece?c.queue:e.queue})}}},B=function(e){var r=we(e.matrix,e.piece),n=r[0],o=r[1],i=g(e.queue),f=q(i.piece);return v(v({},e),{state:K(n,f)?e.state:"LOST",matrix:n,piece:f,heldPiece:e.heldPiece?v(v({},e.heldPiece),{available:!0}):void 0,queue:i.queue,lines:e.lines+o,points:e.points+Ne(o)})},j=100,Ne=function(e){return e===4?j*10:e*j},De={x:P.GAME_WIDTH/2-P.BLOCK_WIDTH/2,y:0},q=function(e){return{position:De,piece:e,rotation:0}},m=function(e,r){if(r.state!=="PLAYING")return r;var n=e(r.matrix,r.piece);return n?v(v({},r),{piece:n}):r},U=function(){var e=me(5),r=g(e);return{state:"PLAYING",points:0,lines:0,matrix:_e(),piece:q(r.piece),heldPiece:void 0,queue:r.queue}};function Me(e){var r=e.matrix;return r=G(r,Q(r,e.piece),!0),G(r,e.piece)}var N=d.createContext(U());function Re(){var e=d.useContext(N),r=Me(e);return d.createElement("table",{className:"game-board"},d.createElement("tbody",null,r.map(function(n,o){var i=n.map(function(f,c){var h="game-block ".concat(f?z(f):"block-empty");return d.createElement("td",{key:c,className:h})});return d.createElement("tr",{key:o},i)})))}var xe=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ge=function(e){var r=e.piece,n=r&&H(r)[0],o=n??xe,i=o.map(function(f,c){var h=f.map(function(_,O){var p="game-block ";return r&&_?p+=z(r):p+="block-empty",d.createElement("td",{key:O,className:p})});return d.createElement("tr",{key:c},h)});return d.createElement("table",{className:"piece-view"},d.createElement("tbody",null,i))};const re=Ge;function He(){var e=d.useContext(N).heldPiece;return d.createElement(re,{piece:e==null?void 0:e.piece})}function ge(){var e=d.useContext(N).queue;return d.createElement("div",null,e.queue.map(function(r,n){return d.createElement(re,{piece:r,key:n})}))}var ne={exports:{}};(function(e){(function(r){var n,o={},i={16:!1,18:!1,17:!1,91:!1},f="all",c={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},h={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},_=function(t){return h[t]||t.toUpperCase().charCodeAt(0)},O=[];for(n=1;n<20;n++)h["f"+n]=111+n;function p(t,a){for(var u=t.length;u--;)if(t[u]===a)return u;return-1}function C(t,a){if(t.length!=a.length)return!1;for(var u=0;u<t.length;u++)if(t[u]!==a[u])return!1;return!0}var L={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function b(t){for(n in i)i[n]=t[L[n]]}function D(t){var a,u,s,w,E,y;if(a=t.keyCode,p(O,a)==-1&&O.push(a),(a==93||a==224)&&(a=91),a in i){i[a]=!0;for(s in c)c[s]==a&&(T[s]=!0);return}if(b(t),!!T.filter.call(this,t)&&a in o){for(y=M(),w=0;w<o[a].length;w++)if(u=o[a][w],u.scope==y||u.scope=="all"){E=u.mods.length>0;for(s in i)(!i[s]&&p(u.mods,+s)>-1||i[s]&&p(u.mods,+s)==-1)&&(E=!1);(u.mods.length==0&&!i[16]&&!i[18]&&!i[17]&&!i[91]||E)&&u.method(t,u)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}}function oe(t){var a=t.keyCode,u,s=p(O,a);if(s>=0&&O.splice(s,1),(a==93||a==224)&&(a=91),a in i){i[a]=!1;for(u in c)c[u]==a&&(T[u]=!1)}}function ae(){for(n in i)i[n]=!1;for(n in c)T[n]=!1}function T(t,a,u){var s,w;s=W(t),u===void 0&&(u=a,a="all");for(var E=0;E<s.length;E++)w=[],t=s[E].split("+"),t.length>1&&(w=F(t),t=[t[t.length-1]]),t=t[0],t=_(t),t in o||(o[t]=[]),o[t].push({shortcut:s[E],scope:a,method:u,key:s[E],mods:w})}function ue(t,a){var u,s,w=[],E,y,x;for(u=W(t),y=0;y<u.length;y++){if(s=u[y].split("+"),s.length>1&&(w=F(s),t=s[s.length-1]),t=_(t),a===void 0&&(a=M()),!o[t])return;for(E=0;E<o[t].length;E++)x=o[t][E],x.scope===a&&C(x.mods,w)&&(o[t][E]={})}}function ce(t){return typeof t=="string"&&(t=_(t)),p(O,t)!=-1}function se(){return O.slice(0)}function fe(t){var a=(t.target||t.srcElement).tagName;return!(a=="INPUT"||a=="SELECT"||a=="TEXTAREA")}for(n in c)T[n]=!1;function le(t){f=t||"all"}function M(){return f||"all"}function ve(t){var a,u,s;for(a in o)for(u=o[a],s=0;s<u.length;)u[s].scope===t?u.splice(s,1):s++}function W(t){var a;return t=t.replace(/\s/g,""),a=t.split(","),a[a.length-1]==""&&(a[a.length-2]+=","),a}function F(t){for(var a=t.slice(0,t.length-1),u=0;u<a.length;u++)a[u]=c[a[u]];return a}function R(t,a,u){t.addEventListener?t.addEventListener(a,u,!1):t.attachEvent&&t.attachEvent("on"+a,function(){u(window.event)})}R(document,"keydown",function(t){D(t)}),R(document,"keyup",oe),R(window,"focus",ae);var pe=r.key;function de(){var t=r.key;return r.key=pe,t}r.key=T,r.key.setScope=le,r.key.getScope=M,r.key.deleteScope=ve,r.key.filter=fe,r.key.isPressed=ce,r.key.getPressedKeyCodes=se,r.key.noConflict=de,r.key.unbind=ue,e.exports=T})(he)})(ne);var qe=ne.exports;const te=Ee(qe);var S=[],k=!1;document.addEventListener("keydown",function(e){return e.shiftKey&&!k&&(k=e.shiftKey,Ue()),!0});document.addEventListener("keyup",function(e){return!e.shiftKey&&k&&(k=e.shiftKey),!0});function Ue(){S.forEach(function(e){e()})}const ie={bind:function(e){S.push(e)},unbind:function(e){var r=S.indexOf(e);r!==-1&&S.splice(r,1)}};var We=function(e,r){d.useEffect(function(){var n=Object.entries(e).reduce(function(o,i){var f=i[0],c=i[1];return o[f]=function(){return r(c)},o},{});return Fe(n),function(){return Ve(n)}},[e,r])};function Fe(e){Object.keys(e).forEach(function(r){var n=e[r];r==="shift"&&n?ie.bind(n):n&&te(r,n)})}function Ve(e){Object.keys(e).forEach(function(r){if(r==="shift"){var n=e[r];n&&ie.unbind(n)}else te.unbind(r)})}var Be={down:"MOVE_DOWN",left:"MOVE_LEFT",right:"MOVE_RIGHT",space:"HARD_DROP",z:"FLIP_COUNTERCLOCKWISE",x:"FLIP_CLOCKWISE",up:"FLIP_CLOCKWISE",p:"TOGGLE_PAUSE",c:"HOLD",shift:"HOLD"},je=function(e){return Math.pow(.8-(e-1)*.007,e-1)};function ze(e){var r,n=d.useReducer(Ke,U()),o=n[0],i=n[1],f=(r=e.keyboardControls)!==null&&r!==void 0?r:Be;We(f,i);var c=ke(o);d.useEffect(function(){var _;return o.state==="PLAYING"&&(_=window.setInterval(function(){i("TICK")},je(c)*1e3)),function(){window.clearInterval(_)}},[o.state,c]);var h=d.useMemo(function(){return{pause:function(){return i("PAUSE")},resume:function(){return i("RESUME")},hold:function(){return i("HOLD")},hardDrop:function(){return i("HARD_DROP")},moveDown:function(){return i("MOVE_DOWN")},moveLeft:function(){return i("MOVE_LEFT")},moveRight:function(){return i("MOVE_RIGHT")},flipClockwise:function(){return i("FLIP_CLOCKWISE")},flipCounterclockwise:function(){return i("FLIP_COUNTERCLOCKWISE")},restart:function(){return i("RESTART")}}},[i]);return d.createElement(N.Provider,{value:o},e.children({HeldPiece:He,Gameboard:Re,PieceQueue:ge,points:o.points,linesCleared:o.lines,state:o.state,level:c,controller:h}))}export{ze as default};
